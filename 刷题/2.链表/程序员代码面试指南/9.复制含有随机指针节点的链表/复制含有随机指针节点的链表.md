# 复制含有随机指针节点的链表

## 题目

一种特殊的链表节点类描述如下:

```
public class Node {
       public int value;
       public Node next;
       public Node rand;
       public Node(int data) {
               this.value = data;
       }
}
```

Node 类中的 value 是节点值，next 指针和正常单链表中 next 指针的意义一样，都指向下一 个节点，rand 指针是 Node 类中新增的指针，这个指针可能指向链表中的任意一个节点，也可 能指向 null。

给定一个由 Node 节点类型组成的无环单链表的头节点 head，请实现一个函数完成这个链 表中所有结构的复制，并返回复制的新链表的头节点。例如:链表 1->2->3->null，假设 1 的 rand 指针指向 3，2 的 rand
指针指向 null，3 的 rand 指针指向 1。复制后的链表应该也是这种结构， 比如，1′->2′->3′->null，1′的 rand 指针指向 3′，2′的 rand 指针指向 null，3′的 rand 指针指向 1′， 最后返回
1′。

## 进阶
不使用额外的数据结构，只用有限几个变量，且在时间复杂度为 O(N)内完成原问题要实现的函数。

## 难度
2颗星


## 解题思路
### 普通解法
时间复杂度: O(N)，额外空间复杂度: O(N)

需要: 哈希表结构。

* Step 1: 从左到右遍历链表，对每个节点都复制生成相应的副本节点，然后将对应关系放入哈希表 `map` 中。
* Step 2: 再从左到右遍历链表，此时就可以设置每一个副本节点的 next 和 rand 指针。
* Step 3: 将 1′节点作为结果返回即可。

### 进阶解法
使用有限几个变量来完成功能。

步骤:
* 1.从左到右遍历链表，对每个节点 cur 都复制生成相应的副本节点 copy，然后把 copy 放 在 cur 和下一个要遍历节点的中间。

例如:原链表 1->2->3->null，在步骤 1 中完成后，原链表变成 1->1′->2->2′->3->3′->null。

* 2.再从左到右遍历链表，在遍历时设置每一个副本节点的 rand 指针。还是举例来说明调整过程。

例如:此时链表为 1->1′->2->2′->3->3′->null，假设 1 的 rand 指针指向 3，2 的 rand 指针指向 null，3 的 rand 指针指向 1。遍历到节点 1 时，节点 1 的下一个节点 1.next 就是其副本节点 1′。 1 的 rand 指针指向 3，所以 1′的 rand 指针应该指向 3′。如何找到 3′呢?因为每个节点的副本节 点都在自己的后一个，所以此时通过 3.next 就可以找到 3′，令 1′.next=3′即可。以这种方式可以 设置每一个副本节点的 rand 指针。

* 3.步骤 2 完成后，节点 1，2，3，......之间的 rand 关系没有任何变化，节点 1′，2′，3′...... 之间的 rand 关系也被正确设置了，此时所有的节点与副本节点串在一起，将其分离出来即可。

例如:此时链表为 1->1′->2->2′->3->3′->null，分离成 1->2->3->null 和 1′->2′->3′->null 即可， 并且在这一步中，每个节点的 rand 指针不用做任何调整，在步骤 2 中都已经设置好。

* 4.将 1′节点作为结果返回即可。

